<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Mobius - Laziness, Impatience and Hubris</title><meta name="author" content="Mobius Wu"><meta name="copyright" content="Mobius Wu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Laziness, Impatience and Hubris">
<meta property="og:type" content="website">
<meta property="og:title" content="Mobius">
<meta property="og:url" content="https://dopamine908.github.io/page/3/index.html">
<meta property="og:site_name" content="Mobius">
<meta property="og:description" content="Laziness, Impatience and Hubris">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://dopamine908.github.io/img/mobius_stripe.png">
<meta property="article:author" content="Mobius Wu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dopamine908.github.io/img/mobius_stripe.png"><link rel="shortcut icon" href="/img/mobius_stripe.png"><link rel="canonical" href="https://dopamine908.github.io/page/3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Mobius',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-07-28 12:33:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/mobius_stripe.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><hr class="custom-hr"/></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Mobius"><span class="site-name">Mobius</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/07/08/LaravelTesting/TestController/" title="Testing Laravel - 測試 Controller">Testing Laravel - 測試 Controller</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-07-08T14:25:44.000Z" title="Created 2021-07-08 14:25:44">2021-07-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Testing-Laravel/">Testing Laravel</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/PHP/">PHP</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Laravel/">Laravel</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Controller/">Controller</a></span></div><div class="content">Testing Laravel - 測試 Controller本文章使用的開發環境為PHP : 8.0.8Laravel : 8.51.0

在 Laravel 的開發過程中我們想要對 response 寫測試的時候，比較常見的是使用官方 HTTP Tests 章節內提到對於 api 回傳的 json 去做驗證
但我們也很常遇到前後端沒有拆分的那麼乾淨的專案，這樣的專案會使用 SSR(Server Side Render) 形式去回傳 response ，這時候我們通常會在 laravel 的 controller 回傳一個 view 然後夾帶一些需要使用的參數
假設我們今天的 web.php 有一個 route
web.php
1Route::get(&#x27;demo_controller_test&#x27;, DemoTestController::class);

對應到我們的 DemoTestController
DemoTestController
12345678910111213class DemoTestController extends Controller& ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/06/25/Other/SshConfig/" title="金魚腦記不住想要 ssh 的 ip ?">金魚腦記不住想要 ssh 的 ip ?</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-06-25T14:25:44.000Z" title="Created 2021-06-25 14:25:44">2021-06-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%97%A5%E5%B8%B8%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/">日常開發筆記</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/SSH/">SSH</a></span></div><div class="content">金魚腦記不住想要 ssh 的 ip ?筆者開發的情境時常會需要去連線不同的主機，所以必須要去記憶很多組主機的 ip ，這樣在使用 ssh 的時候才有辦法知道要連線的目標，但是 ip 實在是太難記憶了
這時候我們可以透過設定 ssh config 來減輕我們腦袋的負擔
12cd ~/.sshvim config

我們可以新增設定的形式
config
1234Host devHostname 127.0.0.1identityfile ~/.ssh/id_rsaUser mobius


Host:你想要設定的主機名稱
Hostname: ip
identityfile: 連線主機用的 key 存放位置
User: 用來登入的 user name

如果想要設定多組的話就是往下持續遞增這樣的區塊就可以了
config
123456789Host devHostname 127.0.0.1identityfile ~/.ssh/id_rsaUser mobiusHost productionHostname 123.123.123.123identityfile ~/.ssh/id_rsa ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/06/13/UnitTestArt/ch8_sec8-2/" title="單元測試的藝術 - Ch8 好的單元測試的支柱 - Sec. 8.2 撰寫可維護的測試">單元測試的藝術 - Ch8 好的單元測試的支柱 - Sec. 8.2 撰寫可維護的測試</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-06-13T13:42:52.000Z" title="Created 2021-06-13 13:42:52">2021-06-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Unit-Test/">Unit Test</a></span></div><div class="content">單元測試的藝術 - Ch8 好的單元測試的支柱 - Sec. 8.2 撰寫可維護的測試隨著時間推移，測試會變得難以理解及維護，所以可維護性是大多數開發人員撰寫單元測試的核心問題之一。
8.2.1 測試私有或保護的方法在測試時，你應該只考慮公開契約（整體功能），因爲私有方法不會獨立存在，他必定會被某個公開方法或是私有方法呼叫，也就是說，任何私有方法通常都是更大的工作單元的使用案例的一部分。
如果一個私有方法值得被測試，那他也許應該是公開的、靜態的，或是至少是內部的（ internal ），或者應該將它獨立到另一個類別中。
讓方法變成公開方法如果你覺得某個私有方法具有被測試的價值，那可能表示這個方法對於呼叫端來說有某種已知的行為或契約的效用，將這個方法改成公開的，代表正式將契約對外開放
把方法抽取到新類別中如果一個方法中包含了很多獨立職責的邏輯，或是類別的某些狀態只和這個方法有關，把這個方法抽取到另外一個具有特定功能的類別會更好，也符合單一職責原則。
把方法改成靜態方法如果一個方法沒有用到執行物件的任何變數跟狀態，那你可以考慮把它改為靜態方法，同時這也表示了這個方法為某種輔助方法。
把方法 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/05/20/Other/GitTemplate/" title="金魚腦記不住團隊 git 規範？ 那就用 git template 吧">金魚腦記不住團隊 git 規範？ 那就用 git template 吧</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-05-20T14:25:44.000Z" title="Created 2021-05-20 14:25:44">2021-05-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Git/">Git</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Git/">Git</a></span></div><div class="content">金魚腦記不住團隊 git 規範？ 那就用 git template 吧常常我們在進行團隊協作開發的時候都需要遵循一定的 git commit 規範，而規範通常不是那麼容易被記住，這時候如果在 commit 的時候有人可以提醒我關於規範的大小事就好了
git template 正好可以拿來做這樣的事情，以下稍微介紹一下。
這邊假設我們的 commit 規範是使用 Angular Commit Guidelines 來做範例
多人協作下免不了的是我們必須要將 git commit 去做分類，已達到管理的目的，但你看看像是 Angular Commit Guidelines 的規範光是他的 commit type 就有非常多種


build: Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)
ci: Changes to our CI configuration files and scripts (example scopes: Travi ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/05/09/UnitTestArt/ch6_sec6-3_6-5/" title="單元測試的藝術 - Ch6 深入瞭解隔離框架 - Sec. 6.3 ~ 6.5">單元測試的藝術 - Ch6 深入瞭解隔離框架 - Sec. 6.3 ~ 6.5</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-05-09T13:42:52.000Z" title="Created 2021-05-09 13:42:52">2021-05-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Unit-Test/">Unit Test</a></span></div><div class="content">單元測試的藝術 - Ch6 深入瞭解隔離框架 - Sec. 6.3 ~ 6.56.3 支援適應未來和可用性的功能一個好的測試框架會提供一些讓你可以因應未來變化的一些功能，如：

遞迴假物件
對行為和驗證忽略預設參數
非嚴格驗證與行為
大範圍偽造

6.3.1 遞迴假物件遞迴假物件是在函數回傳其他物件時的一種特殊行為，這些回傳物件會自動產生假物件。
Humanable.php
1234interface Humanable&#123;    public function generatePerson(): Humanable;&#125;

Person.php
123456class Person implements Humanable&#123;    public function generatePerson(): Humanable    &#123;    &#125;&#125;

Test
123456789101112131415161718192021222324/** * @test */public function GeneratePerson()&#123 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/04/22/Laravel/Str_limit/" title="Laravel Helper - Str::limit() 在中文應用場景的大小事">Laravel Helper - Str::limit() 在中文應用場景的大小事</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-04-22T14:25:44.000Z" title="Created 2021-04-22 14:25:44">2021-04-22</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Laravel/">Laravel</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/PHP/">PHP</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Laravel/">Laravel</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Laravel-Helper/">Laravel Helper</a></span></div><div class="content">Laravel Helper - Str::limit() 在中文應用場景的大小事最近在開發上遇到了要擷取中文訊息內容預覽的問題，例如今天我有一個句子

萊布尼茨和牛頓都被普遍認為是獨立的微積分發明者。牛頓最先將微積分應用到普通物理當中，而萊布尼茨創作了不少今天在微積分所使用的符號。牛頓、萊布尼茨都給出了微分、積分的基本規則，二階與更高階導數，近似多項式級數的記法等。在牛頓的時代，微積分基本定理是已知的事實。

擷取自 微積分 wiki
這很可能是某個文章的內容，而我在顯示頁面上的預覽只有要顯示部分的文字，例如前十個字好了，而且我想讓被隱藏的文字用「…」代替，我想顯示的內容大概如下

萊布尼茨和牛頓都被普…

這時候我們就需要用到 Laraevl Helper 裡面幫我們預先寫好的字串處理函式了
我們要使用的是 Str::limit() 這個函式，它可以幫助我們擷取某個字串的前幾個字，並且可以自定義超過字數之後的結尾
Str::limit先來看看官網的例子
12345use Illuminate\Support\Str;$truncated = Str::limit(&#x27;The ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/04/10/UnitTestArt/ch5_sec5-4_sec5-7/" title="單元測試的藝術 - Ch5 隔離框架 - Sec. 5.4 ~ 5.7">單元測試的藝術 - Ch5 隔離框架 - Sec. 5.4 ~ 5.7</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-04-10T13:42:52.000Z" title="Created 2021-04-10 13:42:52">2021-04-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Unit-Test/">Unit Test</a></span></div><div class="content">
單元測試的藝術 - Ch5 隔離框架 - Sec. 5.4 ~ 5.7

5.4 測試事件相關的活動事件是雙向的，所以可以從兩個方面去進行測試

測試監聽事件的那一方
測試觸發事件的那一方

測試事件監聽者我們想檢查一個物件是否有註冊到另一個物件的事件
如果物件被註冊到另外一個物件，我們比較直覺的會想到去檢查物件內部狀態使否有該物件被註冊，但作者認為這是比較不好的方式
比較好的選擇是，檢查監聽物件是否對於發生的事件做出某種反應
1234567891011121314151617181920212223242526272829303132333435class Presenter&#123;    private readonly IView _view;        public Presenter(IView view)    &#123;        _view = view;        this._view.Loaded += OnLoaded; //註冊事件(OnLoaded)    &#125;        private void OnLoaded()    & ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/03/27/WorkingEffectivelyWithLegacyCode/ch25_pt6/" title="Working Effectively with Legacy Code - Ch25 - 解依賴技術 (6)">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (6)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-03-27T11:27:13.000Z" title="Created 2021-03-27 11:27:13">2021-03-27</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Refactoring/">Refactoring</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Legacy-Code/">Legacy Code</a></span></div><div class="content">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (6)21. 子類別化並覆寫方法「子類別化並覆寫方法」是物件導向程式中姐依賴的核心技術，這個手法就是讓我們可以在測試環境下，利用繼承將我們不關心的行為架空，或是覆寫你在乎的行為讓他可以達到感測的目的，事實上這本書中其他的很多手法都是這個手法的變形。
before上有許多方法，假設我們今天要加入測試的方法是 ```sendMessage()``` ，而他的過程中會呼叫一個私有方法 ```createForwardMessage()``` 去生成一個新的訊息，但過程中用到了 ```Session``` 物件，可是測試過程我們沒辦法對真正的 ```Session``` 去做操作。123456789101112131415161718192021222324252627282930313233343536373839**MessageForwarder**```php=class MessageForwarder&#123;    public function sendMessage()  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/03/12/WorkingEffectivelyWithLegacyCode/ch25_pt5/" title="Working Effectively with Legacy Code - Ch25 - 解依賴技術 (5)">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (5)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-03-12T17:36:24.000Z" title="Created 2021-03-12 17:36:24">2021-03-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Refactoring/">Refactoring</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Legacy-Code/">Legacy Code</a></span></div><div class="content">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (5)17. 特性提升有時候我想為類別中的某些方法加入測試，但我在測試中必須要構築的依賴卻又跟我想測試的方法毫無關聯，這樣我勢必得花上大量的成本去對付這些依賴，而這樣做對測試目標的方法毫無幫助。
當然，這個時候我們可以透過「暴露靜態方法」或是「分解出方法物件」去應對，本節介紹另外一個可以嘗試的方法
before我們有一個 Scheduler 類別，我們想要修改 getDeadTime() ，但不關心 updateScheduleItem() ，而 updateScheduleItem() 的實作就是伴隨著某些麻煩的依賴，與 getDeadTime() 的實作完全沒有關聯
Scheduler
123456789101112131415161718192021222324252627282930313233343536373839404142434445class Scheduler&#123;    /**     * @var array     */    private $ite ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2021/03/03/WorkingEffectivelyWithLegacyCode/ch25_pt4/" title="Working Effectively with Legacy Code - Ch25 - 解依賴技術 (4)">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (4)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2021-03-03T13:26:14.000Z" title="Created 2021-03-03 13:26:14">2021-03-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/">讀書會報告</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Test/">Test</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Refactoring/">Refactoring</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Legacy-Code/">Legacy Code</a></span></div><div class="content">Working Effectively with Legacy Code - Ch25 - 解依賴技術 (4)13. 連接替換在物件導向的語言中有很多方法可以讓我們去替換物件，例如讓偽造的類別去實作與要替換的類別同一個物件，或是去繼承相同的基底類別，但在像是 C 這樣的程序式語言裡面卻沒辦法這麼做。
before例如下面這個函數，如果不用預處理手段，就完全沒辦法在編譯期將其替換為另一個函數
1void account_deposit(int amount) 

after我們可以使用 連接替換(Link Subsitution) 來將他替換為另外一個函數。
首先要建立一個 啞元函式庫(dummy library) ，裡面放的假造函式簽章必須要跟原來的函式相同，並在偽造的函式內撰寫你用來感測的內容
12345678void account_deposit(int amount) &#123;	struct Call *call =		(struct Call *)calloc(1, sizeof (struct Cal));	call-&gt;type = ACC_DEPOSIT; 	c ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/mobius_stripe.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mobius Wu</div><div class="author-info__description">Laziness, Impatience and Hubris</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dopamine908"><i class="fab fa-github"></i><span>My Github</span></a></div><div class="sticky_layout"><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Git/"><span class="card-category-list-name">Git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Laravel/"><span class="card-category-list-name">Laravel</span><span class="card-category-list-count">7</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/PHP/"><span class="card-category-list-name">PHP</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Testing-Laravel/"><span class="card-category-list-name">Testing Laravel</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/"><span class="card-category-list-name">日常開發筆記</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/"><span class="card-category-list-name">讀書會報告</span><span class="card-category-list-count">47</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Job/" style="font-size: 1.14em; color: #999b9d">Job</a> <a href="/tags/Design-Pattern/" style="font-size: 1.1em; color: #999">Design Pattern</a> <a href="/tags/Test/" style="font-size: 1.46em; color: #99a7bb">Test</a> <a href="/tags/Pipeline/" style="font-size: 1.1em; color: #999">Pipeline</a> <a href="/tags/Design-Patterns/" style="font-size: 1.3em; color: #99a1ac">Design Patterns</a> <a href="/tags/Laravel-Helper/" style="font-size: 1.1em; color: #999">Laravel Helper</a> <a href="/tags/WTF-PHP/" style="font-size: 1.1em; color: #999">WTF PHP</a> <a href="/tags/Artisan/" style="font-size: 1.1em; color: #999">Artisan</a> <a href="/tags/CI-CD/" style="font-size: 1.1em; color: #999">CI/CD</a> <a href="/tags/ATDD/" style="font-size: 1.14em; color: #999b9d">ATDD</a> <a href="/tags/Command/" style="font-size: 1.14em; color: #999b9d">Command</a> <a href="/tags/Query/" style="font-size: 1.1em; color: #999">Query</a> <a href="/tags/Notification/" style="font-size: 1.1em; color: #999">Notification</a> <a href="/tags/Refactoring/" style="font-size: 1.34em; color: #99a3b0">Refactoring</a> <a href="/tags/Controller/" style="font-size: 1.1em; color: #999">Controller</a> <a href="/tags/Coding-Style/" style="font-size: 1.1em; color: #999">Coding Style</a> <a href="/tags/%E5%A4%A7%E8%A9%B1-AWS-%E9%9B%B2%E7%AB%AF%E6%9E%B6%E6%A7%8B/" style="font-size: 1.18em; color: #999ca1">大話 AWS 雲端架構</a> <a href="/tags/Crontab/" style="font-size: 1.14em; color: #999b9d">Crontab</a> <a href="/tags/Behavioral-Patterns/" style="font-size: 1.22em; color: #999ea4">Behavioral Patterns</a> <a href="/tags/%E6%8F%90%E5%8D%87%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E5%B8%AB%E7%9A%84%E9%9D%A2%E8%A9%A6%E5%8A%9B/" style="font-size: 1.18em; color: #999ca1">提升程式設計師的面試力</a> <a href="/tags/Unit-Test/" style="font-size: 1.22em; color: #999ea4">Unit Test</a> <a href="/tags/Blog/" style="font-size: 1.1em; color: #999">Blog</a> <a href="/tags/Structural-Patterns/" style="font-size: 1.1em; color: #999">Structural Patterns</a> <a href="/tags/PSR/" style="font-size: 1.1em; color: #999">PSR</a> <a href="/tags/SQL/" style="font-size: 1.18em; color: #999ca1">SQL</a> <a href="/tags/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/" style="font-size: 1.1em; color: #999">資料結構</a> <a href="/tags/BDD/" style="font-size: 1.14em; color: #999b9d">BDD</a> <a href="/tags/Clean-Architecture/" style="font-size: 1.38em; color: #99a4b4">Clean Architecture</a> <a href="/tags/Laravel/" style="font-size: 1.34em; color: #99a3b0">Laravel</a> <a href="/tags/%E8%AE%80%E6%9B%B8%E6%9C%83%E5%A0%B1%E5%91%8A/" style="font-size: 1.5em; color: #99a9bf">讀書會報告</a> <a href="/tags/Schedule/" style="font-size: 1.14em; color: #999b9d">Schedule</a> <a href="/tags/API/" style="font-size: 1.14em; color: #999b9d">API</a> <a href="/tags/AWS/" style="font-size: 1.18em; color: #999ca1">AWS</a> <a href="/tags/Creational-Patterns/" style="font-size: 1.18em; color: #999ca1">Creational Patterns</a> <a href="/tags/PHP/" style="font-size: 1.42em; color: #99a6b7">PHP</a> <a href="/tags/SOLID/" style="font-size: 1.14em; color: #999b9d">SOLID</a> <a href="/tags/SSH/" style="font-size: 1.1em; color: #999">SSH</a> <a href="/tags/Git/" style="font-size: 1.1em; color: #999">Git</a> <a href="/tags/Queue/" style="font-size: 1.14em; color: #999b9d">Queue</a> <a href="/tags/Legacy-Code/" style="font-size: 1.26em; color: #999fa8">Legacy Code</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">July 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">February 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">November 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">October 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">September 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">August 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">July 2022</span><span class="card-archive-list-count">1</span></a></li></ul></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Mobius Wu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>